---

copyright:
  years: 2017
lastupdated: "2017-05-02"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}

<!-- Acrolinx: 2017-05-02 -->

# CouchBackup を使用したデータのバックアップ

{{site.data.keyword.cloudant}} の分散の性質は、データ・バックアップの固有の形式を提供します。CouchBackup は、よりパワフルでフレキシブルなデータのバックアップ方法を提供するコマンド・ライン・ツールです。
{:shortdesc}

## 概要

{{site.data.keyword.cloudant_short_notm}} の分散の利点は、クラスターの使用によって実現されます。クラスターでは、データベース内のデータは複数のコピーに保管されます。これらのコピーは、少なくとも 3 台の別々の物理サーバーに分散されます。データ保管にクラスターを使用すると、固有の高可用性 (HA) と災害復旧 (DR) の特性が {{site.data.keyword.cloudant_short_notm}} に与えられます。クラスターを使用すると、データを消失することなく、{{site.data.keyword.cloudant_short_notm}} がクラスター内からのノードの消失を許容するうえで役立ちます。

しかし、これらの HA および DR の特性があっても、拡張されたデータ・バックアップを必要とする可能性がある他のユース・ケースがあります。

<div id="activepassive"></div>

### データ・センターの停止および災害復旧

クラスター間の[継続的複製](../api/replication.html#continuous-replication)は、{{site.data.keyword.cloudant_short_notm}} クラスターが完全に使用可能でない時の問題に対する良いソリューションです。継続的複製は、「アクティブ - パッシブ」モデルです。このモデルの「アクティブ」部分は、継続的複製です。このモデルの「パッシブ」部分は、このレプリカが、通常、アプリケーションからの要求に応答することを目的としていないことを認めています。その代わりに、このレプリカは、元のデータベースのクローンとして主に使用されます。必要な場合は、クローンからデータにアクセスできます。あるいは、[複製](../api/replication.html)を使用して、クローン内のデータをどこか他の場所でリストアすることもできます。

>	**注:** クローンから複製して大規模なデータベースをリストアする場合、長い時間がかかる可能性があります。

### 高可用性、自動フェイルオーバー、地理的ロード・バランシング

[「アクティブ - パッシブ」](#activepassive)アプローチの代替方法は、「アクティブ - アクティブ」モデルを使用するために 2 つのデータ・センターを構成するというものです。

このモデルでは、クラスター A 内のデータベースに対して行われた変更はすべて、クラスター B 内のデータベースに複製されます。同様に、クラスター B 内のデータベースに対して行われた変更はすべて、クラスター A 内のデータベースに複製されます。

>	**注:** このモデルは、{{site.data.keyword.cloudant_short_notm}} ダッシュボードを使用してセットアップできます。{{site.data.keyword.cloudant_short_notm}} サポートからのアクションは必要ありません。

このモデルを実施すると、何らかの可用性基準が満たされれば、データベース・アプリケーションをいずれかのクラスターに「フェイルオーバー」するよう設計できます。可用性基準は、アプリケーション設計の一部として定義できます。

地理的「ロード・バランシング」をアプリケーション設計に組み込むこともできます。例えば、ある地理的地域で使用されているクライアント・アプリケーションは、通常、そのアプリケーションが「近くの」地理的地域にあるクラスター内に保管されているデータにアクセスする時に、より良いパフォーマンスを期待します。「最も近い」クラスターを識別し、データベース照会のためにそのクラスターに接続するようにクライアント・アプリケーションを設計すると、アプリケーションのパフォーマンス向上に役立ちます。

マルチリージョン・アプリケーション環境のセットアップ方法を説明するチュートリアルには、[ここ ![外部リンク・アイコン](../images/launch-glyph.svg "外部リンク・アイコン")](http://www.ibm.com/developerworks/cloud/library/cl-multi-region-bluemix-apps-with-cloudant-and-dyn-trs/index.html){:new_window}からアクセスできます。

### 偶発的または悪意のあるデータ変更

{{site.data.keyword.cloudant_short_notm}} では、データベースのスナップショットを作成するためのメカニズムを提供していません。例えば、以前の既知の状態への文書レベルのロールバックを実現するために、この種類の機能が必要な場合は、次の 2 つの方法のいずれかを使用して同じ効果を達成できる可能性があります。

1.	複製を使用する。これは、データベースを複製して実行します。最終シーケンス ID を必ず記録するようにしてください。ユーザーが決めたスケジュールで、データベースを新しいデータベースに複製します。複製は、最後に記録されたシーケンス ID から開始します。複製のためのシーケンス ID を保持することにより、ロールアップ・メカニズムの効果を生み出すことができます。その結果は、「毎日の」スナップショットから、通常の「毎週の」スナップショットを作成することと同様になります。このアプローチの制限は、削除された文書リビジョンや「トゥームストーン」文書リビジョン、および未解決の競合も複製される点です。

2.	データベースの内容をファイルにダンプする。データベースの内容をファイルにダンプするために使用できるさまざまなツールが存在します。結果として作成されたダンプ・ファイルは、より安価な、ブロック指向のデバイスまたはサービスに保管できます。そのようなアプローチの制限は、通常、現行の文書リビジョンのみがダンプされる点です。この制限は、未解決の競合は含まれないことを意味します。

データベース・ダンプの作成は、さまざまなバックアップ・ソリューションを有効にするための効果的な方法です。したがって、この説明の残りの部分では、このアプローチに焦点を当てます。

<!--
https://developer.ibm.com/clouddataservices/2016/03/22/simple-couchdb-and-cloudant-backup/

A useful approach is to have couchbackup's snapshots placed on the Bluemix Object Storage service, as described here:

https://developer.ibm.com/recipes/tutorials/object-storage-cloudant-backup/
-->
