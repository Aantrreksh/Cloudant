---

copyright:
  years: 2017
lastupdated: "2017-07-12"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}

<!-- Acrolinx: 2017-07-12 -->

# 停止になった変更および振る舞いの変更

この文書では、Cloudant リリースの振る舞いの変更をまとめます。
{:shortdesc}

## CouchDB バージョン 1.6 と Cloudant バージョン 2.0.0 の非互換性

-   Cloudant の最新バージョンと CouchDB 1.6 ベースのコードベースで非互換性が存在します。  
    Cloudant の古いバージョンでは、要求本体に照会パラメーター ("reduce=false") を追加した場合、要求本体の
    パラメーターは無視され、要求 URL 内のパラメーターが優先されます。Cloudant の最近のバージョンでは、
    要求本体の照会パラメーター ("reduce=false") は無視されません。

## 修正されたエラー・メッセージ

- 存在しないリビジョンで文書添付ファイルを put しようとしたときに発生するエラー・メッセージが、次の情報を伴う 409 エラーに変更されました。

	```
	{"error":"not_found","reason":"missing_rev"}
	```

## X-Frame-Options

`X-Frame-Options` 設定は、HTTP 応答を `<frame>`、`<iframe>`、または `<object>` に組み込めるかを制御する応答ヘッダーです。このセキュリティー機能を利用して、クリックジャッキングを防止することができます。

このオプションは、CORS 設定に基づいて構成できます。CORS が有効な場合、`X-Frame-Options` は自動的に有効になり、デフォルトで応答ヘッダー `X-Frame-Options: DENY` を送信します。要求の HOST ヘッダーが、CORS のオリジン・セクションにリストされた URL に一致する場合、`X-Frame-Options: ALLOW-FROM URL` 応答ヘッダーが戻されます。
 
この変更は、ブラウザーから直接データベースにアクセスするお客様に影響する可能性があります。エラー・メッセージ「X-Frame-Options: DENY」が発行されて
サービスが中断する場合は、CORS を有効にしてください ([CORS 構成の設定 (Setting the CORS configuration)](../api/cors.html#setting-the-cors-configuration) を参照)。
CORS を有効にしたら、許可される `origins` のリストに、要求で送信する HOST ヘッダーの値を追加します。

## アクティブ・タスク

-   `_active_tasks` 応答のインデクサー項目で、`user` フィールドがレポートされなくなりました。
-   `_active_tasks` 応答の検索インデクサー項目で、`user` フィールドがレポートされなくなりました。

## ビュー

-   削減されたビュー結果と削減されていないビュー結果の間で、キー値の Unicode 正規化は整合しています。設計文書で raw 照合が指定された場合、このフィックスの結果として、結果順序が変わる可能性があります。
-   ビューまたは `_all_docs` データベースの照会時に、`keys` パラメーターと、`key`、`startkey`、`endkey` のいずれかのパラメーターを指定するのはエラーです。
-   行の突き合わせが不可能な場合に、`startkey` と `endkey` のパラメーターをビューに渡すのはエラーです。例えば、`descending=false` で `startkey` パラメーターが `endkey` パラメーターより大きい場合や、`descending=true` で `startkey` パラメーターが `endkey` パラメーターより小さい場合、Cloudant は `400 Bad Request` エラーを戻します。
-   ビュー文書で `dbcopy` が構成されている場合、それは、設計文書で `options` フィールドに自動的に変換されます。 

## 設計文書

-   設計文書の検証が厳しくなりました。この検証によって、既存の設計文書で問題が発生することは予想されませんが、誤った形式の設計文書は保存に失敗します。
-   サポートされない言語で作成されたビューはすべて、`unknown_query_language` の `error` で応答します。以前、この応答は、`unknown_query_language` の `reason` でした。
-   データベース設計文書の put にヌルの reducer が使用されると、システムは `'(null)'` のエラー理由で応答します。以前は、`((new String("null")))` を戻していました。
-   設計文書に `updates` が指定された場合、それはヌル値を含んではなりません。

## 認証

-   `_session` メタデータ `authentication_handlers` に、`["delegated", "local"]` は含まれなくなりました。

## ユーザー文書

-   `_users` データベースで作成されたユーザー文書の構造を検証します。DBNext アップグレードの後、ユーザー文書は ASF CouchdDB の要件に適合しなければなりません。以前、ユーザー文書の構造は Cloudant によって検証されませんでした。 

## 複製 

-   レプリケーター文書が、`_replication_state_reason` JSON フィールドに最後のエラー・メッセージを保持します。複製が再始動して `triggered` 状態になった後も、このフィールドはそのまま残ります。この変更によって、レプリケーター・コードが、同じエラーであることを検出し、文書に繰り返し書き込まないようにすることができます。
-   複製中にエラーが発生した場合、エラーの理由が変わらない限り、複製文書は更新されません。以前は、複製中にエラーが発生した場合、無限ループが開始して、かなり大きなシャードが生成されました。  

## 結果セット

-   `_db_updates` エンドポイントが、`db_name` という名前のキーを含む結果セットを戻します。以前は、`dbname` という名前のキーを含む結果セットが戻されていました。
-   文書 ID の最大長を設定します。以前は、文書 ID の最大長を定義することはできませんでした。

## `dbcopy`

- `dbcopy` 機能によって、一定の状況下で問題が発生する可能性があります。
  この機能に関する情報は、資料から削除されました。
  `dbcopy` は、できるだけ使用しないようにしてください。
